<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»Ÿè®¡åˆ†æ - Business Gemini Pool</title>
    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* å¤´éƒ¨æ ·å¼ */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        /* å¯¼èˆªæŒ‰é’® */
        .nav-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            color: #333;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-detail {
            color: #666;
            font-size: 0.95em;
        }

        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .chart-container h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.3em;
        }

        .chart {
            height: 300px;
            display: flex;
            align-items: flex-end;
            gap: 10px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            overflow-x: auto;
        }

        .chart-bar {
            min-width: 60px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 5px 5px 0 0;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .chart-bar:hover {
            opacity: 0.8;
        }

        .chart-bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8em;
            white-space: nowrap;
        }

        .chart-bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8em;
            font-weight: 600;
            color: #333;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .table-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .table-container h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.3em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #f8f9fa;
        }

        /* è¿›åº¦æ¡ */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        /* å¾½ç« æ ·å¼ */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* é”™è¯¯æ ·å¼ */
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 3em;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .chart {
                min-height: 200px;
            }

            .nav-buttons {
                justify-content: center;
            }

            .table-container {
                padding: 15px;
            }

            th, td {
                padding: 8px;
                font-size: 0.9em;
            }
        }

        /* å›¾æ ‡æ ·å¼ */
        .icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            text-align: center;
            line-height: 24px;
        }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-size: 0.9em;
            color: #666;
            font-weight: 500;
        }

        .control-group select,
        .control-group input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95em;
        }

        .refresh-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            align-self: flex-end;
        }

        .refresh-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ“Š ç»Ÿè®¡åˆ†æä¸­å¿ƒ</h1>
            <p>Business Gemini Pool è¯¦ç»†ä½¿ç”¨ç»Ÿè®¡å’Œåˆ†æ</p>
        </div>

        <!-- å¯¼èˆªæŒ‰é’® -->
        <div class="nav-buttons">
            <a href="index.html" class="nav-btn">
                <span class="icon">ğŸ </span>
                <span>ä¸»é¡µ</span>
            </a>
            <a href="conversation_manager.html" class="nav-btn">
                <span class="icon">ğŸ’¬</span>
                <span>ä¼šè¯ç®¡ç†</span>
            </a>
            <a href="chat_history.html" class="nav-btn">
                <span class="icon">ğŸ“</span>
                <span>èŠå¤©å†å²</span>
            </a>
            <a href="image_gallery.html" class="nav-btn">
                <span class="icon">ğŸ–¼ï¸</span>
                <span>å›¾ç‰‡ç›¸å†Œ</span>
            </a>
            <a href="analytics.html" class="nav-btn">
                <span class="icon">ğŸ“Š</span>
                <span>ç»Ÿè®¡åˆ†æ</span>
            </a>
            <a href="api_key_manager.html" class="nav-btn active">
                <span class="icon">ğŸ”‘</span>
                <span>å¯†é’¥ç®¡ç†</span>
            </a>
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <div class="control-group">
                <label for="timeRange">æ—¶é—´èŒƒå›´</label>
                <select id="timeRange">
                    <option value="7">æœ€è¿‘7å¤©</option>
                    <option value="30" selected>æœ€è¿‘30å¤©</option>
                    <option value="90">æœ€è¿‘90å¤©</option>
                    <option value="365">æœ€è¿‘1å¹´</option>
                </select>
            </div>
            <div class="control-group">
                <label for="refreshInterval">è‡ªåŠ¨åˆ·æ–°</label>
                <select id="refreshInterval">
                    <option value="0">å…³é—­</option>
                    <option value="30">30ç§’</option>
                    <option value="60">1åˆ†é’Ÿ</option>
                    <option value="300">5åˆ†é’Ÿ</option>
                </select>
            </div>
            <button class="refresh-btn" onclick="refreshData()">
                <span>ğŸ”„ åˆ·æ–°æ•°æ®</span>
            </button>
        </div>

        <!-- æ€»ä½“ç»Ÿè®¡ -->
        <div id="overviewSection">
            <div class="loading">
                <div class="spinner"></div>
                <div>æ­£åœ¨åŠ è½½ç»Ÿè®¡æ•°æ®...</div>
            </div>
        </div>

        <!-- ç”Ÿæˆæ—¶é—´çº¿å›¾è¡¨ -->
        <div id="timelineSection" style="display: none;">
            <div class="chart-container">
                <h3>ğŸ“ˆ å›¾ç‰‡ç”Ÿæˆæ—¶é—´çº¿</h3>
                <div id="timelineChart" class="chart"></div>
            </div>
        </div>

        <!-- æ¨¡å‹ä½¿ç”¨ç»Ÿè®¡ -->
        <div id="modelsSection" style="display: none;">
            <div class="table-container">
                <h3>ğŸ¤– æ¨¡å‹ä½¿ç”¨ç»Ÿè®¡</h3>
                <div id="modelsTable"></div>
            </div>
        </div>

        <!-- APIå¯†é’¥ç»Ÿè®¡ -->
        <div id="apiKeysSection" style="display: none;">
            <div class="table-container">
                <h3>ğŸ”‘ APIå¯†é’¥ä½¿ç”¨ç»Ÿè®¡</h3>
                <div id="apiKeysTable"></div>
            </div>
        </div>

        <!-- çƒ­é—¨å…³é”®è¯ -->
        <div id="keywordsSection" style="display: none;">
            <div class="table-container">
                <h3>ğŸ”¥ çƒ­é—¨å…³é”®è¯åˆ†æ</h3>
                <div id="keywordsTable"></div>
            </div>
        </div>

        <!-- ç”¨æˆ·æ´»åŠ¨ç»Ÿè®¡ -->
        <div id="usersSection" style="display: none;">
            <div class="table-container">
                <h3>ğŸ‘¥ ç”¨æˆ·æ´»åŠ¨ç»Ÿè®¡</h3>
                <div id="usersTable"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/v1/analytics';
        let refreshTimer = null;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            refreshData();
            setupEventListeners();
        });

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            document.getElementById('timeRange').addEventListener('change', refreshData);
            document.getElementById('refreshInterval').addEventListener('change', function() {
                const interval = parseInt(this.value);
                if (interval > 0) {
                    clearInterval(refreshTimer);
                    refreshTimer = setInterval(refreshData, interval * 1000);
                } else {
                    clearInterval(refreshTimer);
                }
            });
        }

        // è·å–APIè¯·æ±‚å¤´
        function getApiHeaders() {
            const apiKey = localStorage.getItem('gemini_api_key') || '';
            const headers = {
                'Content-Type': 'application/json'
            };
            if (apiKey) {
                headers['Authorization'] = `Bearer ${apiKey}`;
            }
            return headers;
        }

        // åˆ·æ–°æ‰€æœ‰æ•°æ®
        async function refreshData() {
            try {
                await Promise.all([
                    loadOverviewData(),
                    loadTimelineData(),
                    loadModelsData(),
                    loadApiKeysData(),
                    loadKeywordsData(),
                    loadUsersData()
                ]);
            } catch (error) {
                console.error('åˆ·æ–°æ•°æ®å¤±è´¥:', error);
                showError('æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // åŠ è½½æ¦‚è§ˆæ•°æ®
        async function loadOverviewData() {
            try {
                const days = document.getElementById('timeRange').value;
                const response = await fetch(`${API_BASE}/overview?days=${days}`, {
                    headers: getApiHeaders()
                });

                if (!response.ok) throw new Error('è·å–æ¦‚è§ˆæ•°æ®å¤±è´¥');

                const data = await response.json();
                renderOverviewStats(data);
            } catch (error) {
                console.error('åŠ è½½æ¦‚è§ˆæ•°æ®å¤±è´¥:', error);
            }
        }

        // æ¸²æŸ“æ¦‚è§ˆç»Ÿè®¡
        function renderOverviewStats(data) {
            const container = document.getElementById('overviewSection');

            if (data.error) {
                container.innerHTML = `<div class="error">${data.error}</div>`;
                return;
            }

            const html = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>ğŸ“Š æ€»ä½“ç»Ÿè®¡</h3>
                        <div class="stat-value">${data.overall.total_generations}</div>
                        <div class="stat-detail">å›¾ç‰‡ç”Ÿæˆæ€»æ•°</div>
                    </div>
                    <div class="stat-card">
                        <h3>âœ… æˆåŠŸç‡</h3>
                        <div class="stat-value">${data.overall.success_rate}%</div>
                        <div class="stat-detail">æˆåŠŸ: ${data.overall.successful_generations} / ${data.overall.total_generations}</div>
                    </div>
                    <div class="stat-card">
                        <h3>ğŸ”‘ æ´»è·ƒå¯†é’¥</h3>
                        <div class="stat-value">${data.overall.active_api_keys}</div>
                        <div class="stat-detail">æ­£åœ¨ä½¿ç”¨çš„APIå¯†é’¥æ•°é‡</div>
                    </div>
                    <div class="stat-card">
                        <h3>ğŸ‘¥ æ´»è·ƒç”¨æˆ·</h3>
                        <div class="stat-value">${data.overall.unique_users}</div>
                        <div class="stat-detail">ç”Ÿæˆå›¾ç‰‡çš„å”¯ä¸€ç”¨æˆ·æ•°</div>
                    </div>
                    <div class="stat-card">
                        <h3>âš¡ å¹³å‡è€—æ—¶</h3>
                        <div class="stat-value">${Math.round(data.overall.avg_generation_duration_ms)}ms</div>
                        <div class="stat-detail">å•å¼ å›¾ç‰‡å¹³å‡ç”Ÿæˆæ—¶é—´</div>
                    </div>
                    <div class="stat-card">
                        <h3>ğŸ“… æ´»è·ƒå¤©æ•°</h3>
                        <div class="stat-value">${data.overall.active_days}</div>
                        <div class="stat-detail">æœ€è¿‘${data.time_range_days}å¤©å†…çš„æ´»è·ƒå¤©æ•°</div>
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        // åŠ è½½æ—¶é—´çº¿æ•°æ®
        async function loadTimelineData() {
            try {
                const days = Math.min(parseInt(document.getElementById('timeRange').value), 7);
                const response = await fetch(`${API_BASE}/timeline?days=${days}`, {
                    headers: getApiHeaders()
                });

                if (!response.ok) throw new Error('è·å–æ—¶é—´çº¿æ•°æ®å¤±è´¥');

                const data = await response.json();
                renderTimelineChart(data.timeline);
            } catch (error) {
                console.error('åŠ è½½æ—¶é—´çº¿æ•°æ®å¤±è´¥:', error);
            }
        }

        // æ¸²æŸ“æ—¶é—´çº¿å›¾è¡¨
        function renderTimelineChart(data) {
            const container = document.getElementById('timelineSection');
            const chartContainer = document.getElementById('timelineChart');

            if (!data || data.length === 0) {
                container.style.display = 'none';
                return;
            }

            // æ‰¾å‡ºæœ€å¤§å€¼
            const maxValue = Math.max(...data.map(item => item.total_generations));

            let chartHTML = '';
            data.reverse().forEach(item => {
                const height = (item.total_generations / maxValue) * 250;
                const date = new Date(item.date).toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' });

                chartHTML += `
                    <div class="chart-bar" style="height: ${height}px;" title="${date}: ${item.total_generations}å¼ å›¾ç‰‡">
                        <div class="chart-bar-value">${item.total_generations}</div>
                        <div class="chart-bar-label">${date}</div>
                    </div>
                `;
            });

            chartContainer.innerHTML = chartHTML;
            container.style.display = 'block';
        }

        // åŠ è½½æ¨¡å‹æ•°æ®
        async function loadModelsData() {
            try {
                const response = await fetch(`${API_BASE}/models`, {
                    headers: getApiHeaders()
                });

                if (!response.ok) throw new Error('è·å–æ¨¡å‹æ•°æ®å¤±è´¥');

                const data = await response.json();
                renderModelsTable(data.models);
            } catch (error) {
                console.error('åŠ è½½æ¨¡å‹æ•°æ®å¤±è´¥:', error);
            }
        }

        // æ¸²æŸ“æ¨¡å‹è¡¨æ ¼
        function renderModelsTable(data) {
            const container = document.getElementById('modelsSection');
            const tableContainer = document.getElementById('modelsTable');

            if (!data || data.length === 0) {
                container.style.display = 'none';
                return;
            }

            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>æ¨¡å‹åç§°</th>
                            <th>æ€»è¯·æ±‚</th>
                            <th>æˆåŠŸè¯·æ±‚</th>
                            <th>æˆåŠŸç‡</th>
                            <th>ç”Ÿæˆå›¾ç‰‡</th>
                            <th>æœ€åä½¿ç”¨</th>
                            <th>çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach(model => {
                const successRate = model.success_rate_percent || 0;
                const lastUsed = model.last_used_at ? new Date(model.last_used_at).toLocaleString('zh-CN') : 'ä»æœªä½¿ç”¨';
                const statusBadge = model.is_active ? '<span class="badge badge-success">æ´»è·ƒ</span>' : '<span class="badge badge-warning">éæ´»è·ƒ</span>';

                tableHTML += `
                    <tr>
                        <td><strong>${model.model_name}</strong></td>
                        <td>${model.total_requests}</td>
                        <td>${model.successful_requests}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div class="progress-bar" style="flex: 1;">
                                    <div class="progress-fill" style="width: ${successRate}%"></div>
                                </div>
                                <span>${successRate}%</span>
                            </div>
                        </td>
                        <td>${model.total_images_generated}</td>
                        <td>${lastUsed}</td>
                        <td>${statusBadge}</td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            tableContainer.innerHTML = tableHTML;
            container.style.display = 'block';
        }

        // åŠ è½½APIå¯†é’¥æ•°æ®
        async function loadApiKeysData() {
            try {
                const response = await fetch(`${API_BASE}/api-keys?limit=15`, {
                    headers: getApiHeaders()
                });

                if (!response.ok) throw new Error('è·å–APIå¯†é’¥æ•°æ®å¤±è´¥');

                const data = await response.json();
                renderApiKeysTable(data.api_keys);
            } catch (error) {
                console.error('åŠ è½½APIå¯†é’¥æ•°æ®å¤±è´¥:', error);
            }
        }

        // æ¸²æŸ“APIå¯†é’¥è¡¨æ ¼
        function renderApiKeysTable(data) {
            const container = document.getElementById('apiKeysSection');
            const tableContainer = document.getElementById('apiKeysTable');

            if (!data || data.length === 0) {
                container.style.display = 'none';
                return;
            }

            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>APIå¯†é’¥</th>
                            <th>Team ID</th>
                            <th>æ€»è¯·æ±‚</th>
                            <th>æˆåŠŸç‡</th>
                            <th>ç”Ÿæˆå›¾ç‰‡</th>
                            <th>å¹³å‡è€—æ—¶</th>
                            <th>æœ€åä½¿ç”¨</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach(apiKey => {
                const successRate = apiKey.success_rate_percent || 0;
                const lastUsed = apiKey.last_used_at ? new Date(apiKey.last_used_at).toLocaleString('zh-CN') : 'ä»æœªä½¿ç”¨';
                const maskedKey = apiKey.api_key_masked || 'æœªçŸ¥';

                tableHTML += `
                    <tr>
                        <td><code>${maskedKey}</code></td>
                        <td>${apiKey.account_team_id || 'æœªçŸ¥'}</td>
                        <td>${apiKey.total_requests}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div class="progress-bar" style="flex: 1;">
                                    <div class="progress-fill" style="width: ${successRate}%"></div>
                                </div>
                                <span>${successRate}%</span>
                            </div>
                        </td>
                        <td>${apiKey.total_images_generated}</td>
                        <td>${apiKey.avg_images_per_request || 0}</td>
                        <td>${lastUsed}</td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            tableContainer.innerHTML = tableHTML;
            container.style.display = 'block';
        }

        // åŠ è½½å…³é”®è¯æ•°æ®
        async function loadKeywordsData() {
            try {
                const response = await fetch(`${API_BASE}/keywords?limit=20`, {
                    headers: getApiHeaders()
                });

                if (!response.ok) throw new Error('è·å–å…³é”®è¯æ•°æ®å¤±è´¥');

                const data = await response.json();
                renderKeywordsTable(data.keywords);
            } catch (error) {
                console.error('åŠ è½½å…³é”®è¯æ•°æ®å¤±è´¥:', error);
            }
        }

        // æ¸²æŸ“å…³é”®è¯è¡¨æ ¼
        function renderKeywordsTable(data) {
            const container = document.getElementById('keywordsSection');
            const tableContainer = document.getElementById('keywordsTable');

            if (!data || data.length === 0) {
                container.style.display = 'none';
                return;
            }

            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>å…³é”®è¯</th>
                            <th>ä½¿ç”¨æ¬¡æ•°</th>
                            <th>ä½¿ç”¨ç”¨æˆ·æ•°</th>
                            <th>ç”Ÿæˆå›¾ç‰‡æ•°</th>
                            <th>æœ€åä½¿ç”¨</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach(keyword => {
                const lastUsed = keyword.last_used_at ? new Date(keyword.last_used_at).toLocaleString('zh-CN') : 'æœªçŸ¥';

                tableHTML += `
                    <tr>
                        <td><strong>${keyword.keyword}</strong></td>
                        <td>${keyword.usage_count}</td>
                        <td>${keyword.unique_users}</td>
                        <td>${keyword.total_images_generated}</td>
                        <td>${lastUsed}</td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            tableContainer.innerHTML = tableHTML;
            container.style.display = 'block';
        }

        // åŠ è½½ç”¨æˆ·æ•°æ®
        async function loadUsersData() {
            try {
                const response = await fetch(`${API_BASE}/users?limit=15`, {
                    headers: getApiHeaders()
                });

                if (!response.ok) throw new Error('è·å–ç”¨æˆ·æ•°æ®å¤±è´¥');

                const data = await response.json();
                renderUsersTable(data.users);
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
            }
        }

        // æ¸²æŸ“ç”¨æˆ·è¡¨æ ¼
        function renderUsersTable(data) {
            const container = document.getElementById('usersSection');
            const tableContainer = document.getElementById('usersTable');

            if (!data || data.length === 0) {
                container.style.display = 'none';
                return;
            }

            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ç”¨æˆ·ID</th>
                            <th>æ€»è¯·æ±‚</th>
                            <th>æˆåŠŸè¯·æ±‚</th>
                            <th>ç”Ÿæˆå›¾ç‰‡</th>
                            <th>æ€»è€—æ—¶</th>
                            <th>é¦–æ¬¡è¯·æ±‚</th>
                            <th>æœ€åè¯·æ±‚</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach(user => {
                const firstRequest = user.first_request_at ? new Date(user.first_request_at).toLocaleString('zh-CN') : 'æœªçŸ¥';
                const lastRequest = user.last_request_at ? new Date(user.last_request_at).toLocaleString('zh-CN') : 'æœªçŸ¥';
                const userId = user.user_id ? user.user_id.substring(0, 8) + '***' : 'æœªçŸ¥';

                tableHTML += `
                    <tr>
                        <td><code>${userId}</code></td>
                        <td>${user.total_requests}</td>
                        <td>${user.successful_requests}</td>
                        <td>${user.total_images_generated}</td>
                        <td>${Math.round(user.total_generation_time / 1000)}ç§’</td>
                        <td>${firstRequest}</td>
                        <td>${lastRequest}</td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            tableContainer.innerHTML = tableHTML;
            container.style.display = 'block';
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            const container = document.getElementById('overviewSection');
            container.innerHTML = `<div class="error">âŒ ${message}</div>`;
        }
    </script>
</body>
</html>